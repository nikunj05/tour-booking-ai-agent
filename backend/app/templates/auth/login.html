{% extends "partials/authmaster.html" %}
{% block content %}
<div class="card authentication-field">
    <div class="card-body login-card-body">

        <div class="heading-section">
            <h2 class="auth-heading">Login</h2>
            <p class="auth-description">Please log in to continue</p>
        </div>

        {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <form id="loginForm"
            action="{{ request.url_for('login_submit') }}"
            method="post"
            class="form-fields"
            novalidate>
            <div class="input-field">
                <div class="input-group">
                    <input name="email" type="email" value=""
                        class="form-control" placeholder="Enter your email" required>
                </div>
            </div>

            <div class="input-field">
                <div class="input-group">
                    <input name="password" type="password"
                        class="form-control password_field" placeholder="Password" required minlength="6">
                    <button type="button" class="pass-show-hide-btn">
                        <img src="{{ url_for('static', path='assets/icon/eye-hide-icon.svg') }}" class="toggle_password">
                    </button>
                </div>
            </div>

            <div class="action">
                <button type="submit" class="btn button-default btn-block">LogIn</button>
            </div>

            <div class="forget-password-field text-end">
                <div class="login-forget-password">
                    <div class="m-0 d-flex justify-content-between">
                        <a href="">Forgot password?</a>
                    </div>
                </div>
            </div>
        </form>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#loginForm').validate({
        rules: {
            email: { required: true, email: true },
            password: { required: true }
        },
        errorElement: 'span',
        errorClass: 'invalid-feedback',
        highlight: function(element) { $(element).addClass('is-invalid'); },
        unhighlight: function(element) { $(element).removeClass('is-invalid'); }
    });
});

window.addEventListener("DOMContentLoaded", () => {
    const toggles = document.querySelectorAll(".toggle_password");
    const inputs = document.querySelectorAll(".password_field");

    toggles.forEach((toggle, index) => {
        toggle.addEventListener("click", () => {
            const input = inputs[index];
            const isHidden = input.type === "password";
            input.type = isHidden ? "text" : "password";
            toggle.src = isHidden
                ? "{{ url_for('static', path='assets/icon/eye-show-icon.svg') }}"
                : "{{ url_for('static', path='assets/icon/eye-hide-icon.svg') }}";
        });
    });
});
</script>
{% endblock %}
