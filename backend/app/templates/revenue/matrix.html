{% extends "layout.html" %}
{% block content %}

<div class="container-fluid py-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold mb-0">Revenue Overview</h3>
            <small class="text-muted">Year {{ year }}</small>
        </div>

        <!-- Better Year Selector -->
        <form method="get" class="year-form">
            <select name="year" class="year-select" onchange="this.form.submit()">
                {% for y in range(current_year, current_year-10, -1) %}
                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>
                        {{ y }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- MATRIX TABLE -->
    <div class="matrix-wrapper">

        <table class="revenue-matrix">
            <thead>
                <tr>
                    <th class="sticky-col text-start">Tour Name</th>
                    {% for m in ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"] %}
                        <th>{{ m }}</th>
                    {% endfor %}
                    <th>Total Revenue</th>
                    <th>Total Bookings</th>
                </tr>
            </thead>

            <tbody>
                {% for tour, info in revenue_data.items() %}
                <tr>
                    <td class="sticky-col fw-semibold text-start">
                        {{ tour }}
                    </td>

                    {% for month in range(1,13) %}
                        {% set m = info.months[month] %}
                        <td>
                            {% if m.revenue > 0 %}
                                <div class="revenue-amount">
                                    {{ company.currency }} {{ "{:,.0f}".format(m.revenue) }}
                                </div>
                                <span class="booking-badge">
                                    {{ m.bookings }}
                                </span>
                            {% else %}
                                â€”
                            {% endif %}
                        </td>
                    {% endfor %}

                    <td class="total-cell">
                        {{ company.currency }} {{ "{:,.0f}".format(info.total_revenue) }}
                    </td>

                    <td class="booking-total">
                        {{ info.total_bookings }}
                    </td>

                </tr>
                {% endfor %}

                <!-- GRAND TOTAL ROW -->
                <tr class="grand-total-row">
                    <td class="sticky-col fw-bold text-start">Grand Total</td>

                    {% for month in range(1,13) %}
                        <td></td>
                    {% endfor %}

                    <td class="fw-bold text-success">
                        {{ company.currency }} {{ "{:,.0f}".format(grand_total_revenue) }}
                    </td>

                    <td class="fw-bold">
                        {{ grand_total_bookings }}
                    </td>
                </tr>

            </tbody>
        </table>

    </div>

</div>


<style>

/* ===== Year Select Modern ===== */

.year-form {
    position: relative;
}

.year-select {
    padding: 8px 14px;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
    background: white;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s ease;
}

.year-select:hover {
    border-color: #0d6efd;
}

.year-select:focus {
    outline: none;
    border-color: #0d6efd;
    box-shadow: 0 0 0 3px rgba(13,110,253,0.15);
}

/* ===== Table Wrapper ===== */

.matrix-wrapper {
    overflow-x: auto;
    background: white;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.04);
}

/* ===== Table ===== */

.revenue-matrix {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

.revenue-matrix thead th {
    background: #f8f9fa;
    padding: 14px;
    font-weight: 600;
    text-align: center;
    border-bottom: 1px solid #e9ecef;
}

.revenue-matrix tbody td {
    padding: 14px;
    text-align: center;
    border-bottom: 1px solid #f1f3f5;
}

.revenue-matrix tbody tr:hover {
    background-color: #f9fbff;
}

/* Sticky first column */

.sticky-col {
    position: sticky;
    left: 0;
    background: white;
    z-index: 2;
}

/* Revenue Text */

.revenue-amount {
    font-weight: 600;
}

.booking-badge {
    display: inline-block;
    margin-top: 4px;
    padding: 3px 8px;
    font-size: 12px;
    background: #eef2ff;
    color: #4c6ef5;
    border-radius: 20px;
}

/* Totals */

.total-cell {
    font-weight: 700;
    color: #198754;
}

.booking-total {
    font-weight: 700;
}

.grand-total-row {
    background: #f1f5ff;
}

</style>

{% endblock %}
